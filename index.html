import { useState, useRef } from 'react';

interface Blueprint {
  id: number;
  title: string;
  desc: string;
  imageUrl: string;
  author: string;
}

export default function App() {
  const [currentPage, setCurrentPage] = useState('blueprint');
  const [blueprints, setBlueprints] = useState<Blueprint[]>([
    {
      id: 1,
      title: 'èµ›åšæœ‹å…‹æœºç”²è‰å›¾',
      desc: 'è¿™æ˜¯ä¸ºäº†ä¸‹ä¸ªæœˆçš„æ¨¡å‹å±•è®¾è®¡çš„æ¦‚å¿µå›¾ï¼Œä¸»è¦é‡‡ç”¨äº†é‡é‡‘å±é£æ ¼ã€‚',
      imageUrl: 'https://via.placeholder.com/300x200/667eea/ffffff?text=Blueprint+1',
      author: 'æœºç”²å¤§å¸ˆ'
    }
  ]);
  
  const [title, setTitle] = useState('');
  const [desc, setDesc] = useState('');
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handlePageSwitch = (pageId: string) => {
    setCurrentPage(pageId);
  };

  const handleUpload = () => {
    if (!selectedFile) {
      alert('è¯·å…ˆé€‰æ‹©ä¸€å¼ å›¾ç‰‡ï¼');
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      const newBlueprint: Blueprint = {
        id: Date.now(),
        title: title || 'æ— æ ‡é¢˜å›¾çº¸',
        desc: desc || 'æš‚æ— è¯´æ˜...',
        imageUrl: e.target?.result as string,
        author: 'å½“å‰ç”¨æˆ·'
      };
      
      setBlueprints(prev => [newBlueprint, ...prev]);
      setTitle('');
      setDesc('');
      setSelectedFile(null);
      if (fileInputRef.current) {
        fileInputRef.current.value = '';
      }
      alert('å›¾çº¸ä¸Šä¼ æˆåŠŸï¼');
    };
    reader.readAsDataURL(selectedFile);
  };

  const handleDelete = (id: number) => {
    if (confirm('ç¡®å®šè¦æ’¤å›è¿™å¼ å›¾çº¸å—ï¼Ÿ')) {
      setBlueprints(prev => prev.filter(bp => bp.id !== id));
    }
  };

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files[0]) {
      setSelectedFile(e.target.files[0]);
    }
  };

  return (
    <div className="min-h-screen" style={{ backgroundColor: '#f4f7f6', color: '#333', fontFamily: "'Microsoft YaHei', sans-serif" }}>
      {/* Header */}
      <header style={{ 
        background: 'linear-gradient(120deg, #ff9a9e, #a18cd1)', 
        padding: '1rem 2rem', 
        boxShadow: '0 4px 6px rgba(0,0,0,0.1)', 
        position: 'sticky', 
        top: 0, 
        zIndex: 100 
      }}>
        <nav style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', maxWidth: 1200, margin: '0 auto' }}>
          <div className="logo" style={{ fontSize: '1.5rem', fontWeight: 'bold', color: 'white', cursor: 'pointer' }}>
            ACG å¹»æƒ³ä¹¡
          </div>
          <div className="nav-links" style={{ display: 'flex', gap: '20px' }}>
            {['home', 'anime', 'blueprint', 'forum'].map((page) => (
              <button
                key={page}
                onClick={() => handlePageSwitch(page)}
                id={`nav-${page}`}
                className={`nav-btn ${currentPage === page ? 'active' : ''}`}
                style={{
                  background: 'none',
                  border: 'none',
                  color: 'white',
                  fontSize: '1rem',
                  cursor: 'pointer',
                  padding: '5px 10px',
                  borderRadius: '5px',
                  transition: 'background 0.3s'
                }}
              >
                {page === 'home' ? 'é¦–é¡µ' : page === 'anime' ? 'ç•ªå‰§åŒº' : page === 'blueprint' ? 'å›¾çº¸åŒº' : 'è®ºå›'}
              </button>
            ))}
          </div>
        </nav>
      </header>

      {/* Main Content */}
      <main style={{ maxWidth: 1200, margin: '2rem auto', padding: '0 1rem', minHeight: '80vh' }}>
        {/* Blueprint Section */}
        {currentPage === 'blueprint' && (
          <div className="page-section" style={{ animation: 'fadeIn 0.5s' }}>
            <h2 style={{ marginBottom: '2rem' }}>ğŸ“ åˆ›ä½œè€…å·¥åŠ</h2>
            
            {/* Upload Form */}
            <div style={{ 
              background: '#fff', 
              padding: '30px', 
              borderRadius: '10px', 
              boxShadow: '0 4px 15px rgba(0,0,0,0.05)', 
              marginBottom: '40px',
              border: '1px solid #eee'
            }}>
              <h3>ä¸Šä¼ æ–°å›¾çº¸</h3>
              <div className="form-group" style={{ marginBottom: '15px' }}>
                <label htmlFor="bp-title" style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#a18cd1' }}>
                  å›¾çº¸æ ‡é¢˜
                </label>
                <input
                  type="text"
                  id="bp-title"
                  className="form-control"
                  placeholder="ä¾‹å¦‚ï¼šåˆå·æœºè®¾è®¡å›¾"
                  value={title}
                  onChange={(e) => setTitle(e.target.value)}
                  style={{
                    width: '100%',
                    padding: '10px',
                    border: '1px solid #ddd',
                    borderRadius: '5px',
                    boxSizing: 'border-box',
                    fontSize: '1rem'
                  }}
                />
              </div>
              <div className="form-group" style={{ marginBottom: '15px' }}>
                <label htmlFor="bp-desc" style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#a18cd1' }}>
                  è®¾è®¡è¯´æ˜
                </label>
                <textarea
                  id="bp-desc"
                  className="form-control"
                  placeholder="è¯·æè¿°ä½ çš„è®¾è®¡æ€è·¯..."
                  value={desc}
                  onChange={(e) => setDesc(e.target.value)}
                  style={{
                    width: '100%',
                    padding: '10px',
                    border: '1px solid #ddd',
                    borderRadius: '5px',
                    boxSizing: 'border-box',
                    fontSize: '1rem',
                    minHeight: '80px',
                    resize: 'vertical'
                  }}
                />
              </div>
              <div className="form-group" style={{ marginBottom: '15px' }}>
                <label htmlFor="file-input" style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#a18cd1' }}>
                  é€‰æ‹©å›¾ç‰‡
                </label>
                <input
                  type="file"
                  id="file-input"
                  ref={fileInputRef}
                  accept="image/*"
                  onChange={handleFileChange}
                  className="form-control"
                  style={{
                    width: '100%',
                    padding: '10px',
                    border: '1px solid #ddd',
                    borderRadius: '5px',
                    boxSizing: 'border-box',
                    fontSize: '1rem'
                  }}
                />
              </div>
              <button
                className="btn-submit"
                onClick={handleUpload}
                style={{
                  background: '#ff9a9e',
                  color: 'white',
                  border: 'none',
                  padding: '12px 30px',
                  borderRadius: '5px',
                  cursor: 'pointer',
                  fontSize: '1rem',
                  width: '100%',
                  transition: 'opacity 0.2s'
                }}
              >
                ç«‹å³å‘å¸ƒ
              </button>
            </div>

            <h3>æœ€æ–°ä½œå“</h3>
            <div className="grid-container" style={{ 
              display: 'grid', 
              gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', 
              gap: '25px' 
            }}>
              {blueprints.map((bp) => (
                <div key={bp.id} className="card" style={{ 
                  background: '#ffffff', 
                  borderRadius: '10px', 
                  overflow: 'hidden', 
                  boxShadow: '0 4px 10px rgba(0,0,0,0.08)', 
                  transition: 'transform 0.2s',
                  display: 'flex',
                  flexDirection: 'column'
                }}>
                  <div className="card-img-wrapper" style={{ height: '200px', overflow: 'hidden', background: '#f0f0f0' }}>
                    <img 
                      src={bp.imageUrl} 
                      alt={bp.title}
                      style={{ width: '100%', height: '100%', objectFit: 'cover', display: 'block' }}
                    />
                  </div>
                  <div className="card-body" style={{ padding: '20px', flexGrow: 1, display: 'flex', flexDirection: 'column' }}>
                    <h3 className="card-title" style={{ fontSize: '1.2rem', margin: '0 0 10px 0', color: '#a18cd1' }}>
                      {bp.title}
                    </h3>
                    <p className="card-desc" style={{ fontSize: '0.95rem', color: '#555', marginBottom: '15px', lineHeight: '1.5', flexGrow: 1 }}>
                      {bp.desc}
                    </p>
                    <div className="card-footer" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 'auto', paddingTop: '15px', borderTop: '1px solid #eee' }}>
                      <span className="author" style={{ fontSize: '0.85rem', color: '#888' }}>
                        ä½œè€…ï¼š{bp.author}
                      </span>
                      <button
                        className="btn-delete"
                        onClick={() => handleDelete(bp.id)}
                        style={{
                          background: '#ff6b6b',
                          color: 'white',
                          border: 'none',
                          padding: '5px 10px',
                          borderRadius: '4px',
                          cursor: 'pointer',
                          fontSize: '0.8rem',
                          transition: 'background 0.2s'
                        }}
                      >
                        æ’¤å›
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Other Pages Placeholder */}
        {currentPage !== 'blueprint' && (
          <div className="page-section" style={{ animation: 'fadeIn 0.5s' }}>
            <h2>
              {currentPage === 'home' && 'é¦–é¡µ'}
              {currentPage === 'anime' && 'ç•ªå‰§åŒº'}
              {currentPage === 'forum' && 'è®ºå›'}
            </h2>
            <p style={{ color: '#888' }}>è¯¥é¡µé¢æ­£åœ¨å»ºè®¾ä¸­...</p>
          </div>
        )}
      </main>

      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        .nav-btn:hover, .nav-btn.active {
          background: rgba(255,255,255,0.3);
        }
        .form-control:focus {
          outline: none;
          border-color: #ff9a9e;
          box-shadow: 0 0 5px rgba(255, 154, 158, 0.3);
        }
        .btn-submit:hover {
          opacity: 0.9;
        }
        .card:hover {
          transform: translateY(-5px);
        }
        .btn-delete:hover {
          background: #ee5253;
        }
        @media (max-width: 768px) {
          nav { flex-direction: column; }
          .nav-links { margin-top: 15px; }
          .nav-links button { margin: 0 5px; }
        }
      `}</style>
    </div>
  );
}
